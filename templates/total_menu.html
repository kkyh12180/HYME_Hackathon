<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/@ivteplo/utilities.css@1.0.0/build/main.css">
    <script src="./menu.js"></script>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="css/total.css">
    <link rel="stylesheet" href="css/total_menu.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <title>SmartUs</title>
</head>
<body style="margin: 0;">
    <nav class="navbar sticky-top bg-light">
        <div class="container-fluid">
            <div class="navbar-brand" id="logo_mission">
                <img src="../static/media/missionLogo.png" alt="Logo" width="30" class="d-inline-block align-text-top">
                <span style="font-size: 20px;">미션</span>
            </div>
            <div class="mission-box">
                <p id="mission"></p>
                <div class="time-box">
                    <img src="../static/media/sand-clock.png" alt="시계" style="width: 15px">
                    <p class="time-left"></p>
                </div>
            </div>
        </div>
        <div class="progress-container">
            <p class="progress-text">진행률</p>
            <div class="progress">
                <div class="progress-bar bg-success" role="progressbar" aria-label="Success striped example"
                    style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
            </div>
        </div>

    </nav>

    <div class="title">주문</div>

    <div class="contents">
        <!-- <div class="menu_item">
            <button type="button" class="btn btn-light menu_cancel_btn">취소</button>
            <img class="menu_img" src="../static/media/mac_food/hamburger/big_mac_set.png" alt="메뉴">
            <div class="menu_title">빅맥 버거 - 라지세트</div>
            
            <div class="input-group">
                <span class="input-group-btn">
                    <button type="button" class="btn btn-default btn-number" disabled="disabled" data-type="minus" data-field="quant[1]">
                        <span class="glyphicon glyphicon-minus"></span>
                    </button>
                </span>
                <input type="text" name="quant[1]" class="form-control input-number" value="1" min="1" max="10">
                <span class="input-group-btn">
                    <button type="button" class="btn btn-default btn-number" data-type="plus" data-field="quant[1]">
                        <span class="glyphicon glyphicon-plus"></span>
                    </button>
                </span>
            </div>
            <div class="menu_price">(가격)</div>
        </div> -->
      </div>

    <script>
        var menu = menuVar;
        // console.log(menu);
        // console.log(sessionStorage.getItem("basket"));
        var basket = JSON.parse(sessionStorage.getItem("basket"));
        // console.log(basket[0]);
        // item, name, set, side, drink, count, price
        // console.log(menu[basket[0][0]][basket[0][1]][basket[0][2]]);
        for (i = 0; i < basket.length; i++) {
            if (basket[i][0] == 'hamburger') {
                document.write('<div class="menu_item">'+
                    '<button type="button" class="btn btn-light menu_cancel_btn">취소</button>'+
                    '<img class="menu_img" src="'+menu[basket[i][0]][basket[i][1]][basket[i][2]]["img"]+'" alt="메뉴">'+
                    '<div class="menu_title">'+menu[basket[i][0]][basket[i][1]][basket[i][2]]["name"]+'</div>'+
                    '<div class="input-group">'+
                        '<span class="input-group-btn">'+
                            '<button type="button" class="btn btn-default btn-number" data-type="minus" data-field="quant['+i+']">'+
                                '<span class="glyphicon glyphicon-minus"></span>'+
                            '</button>'+
                        '</span>'+
                        '<input type="text" name="quant['+i+']" id="input-'+i+'" class="form-control input-number" value="'+basket[i][5]+'" min="1" max="10">'+
                        '<span class="input-group-btn">'+
                            '<button type="button" class="btn btn-default btn-number" data-type="plus" data-field="quant['+i+']">'+
                                '<span class="glyphicon glyphicon-plus"></span>'+
                            '</button>'+
                        '</span>'+
                    '</div>'+
                    '<div class="menu_price" id="quant['+i+']">'+basket[i][5] * basket[i][6]+'</div>'+
                '</div>');
            } else {
                document.write('<div class="menu_item">'+
                    '<button type="button" class="btn btn-light menu_cancel_btn">취소</button>'+
                    '<img class="menu_img" src="'+menu[basket[i][0]][basket[i][1]]["img"]+'" alt="메뉴">'+
                    '<div class="menu_title">'+menu[basket[i][0]][basket[i][1]]["name"]+'</div>'+
                    '<div class="input-group">'+
                        '<span class="input-group-btn">'+
                            '<button type="button" class="btn btn-default btn-number" data-type="minus" data-field="quant['+i+']">'+
                                '<span class="glyphicon glyphicon-minus"></span>'+
                            '</button>'+
                        '</span>'+
                        '<input type="text" name="quant['+i+']" id="input-'+i+'" class="form-control input-number" value="'+basket[i][5]+'" min="1" max="10">'+
                        '<span class="input-group-btn">'+
                            '<button type="button" class="btn btn-default btn-number" data-type="plus" data-field="quant['+i+']">'+
                                '<span class="glyphicon glyphicon-plus"></span>'+
                            '</button>'+
                        '</span>'+
                    '</div>'+
                    '<div class="menu_price" id="quant['+i+']">'+basket[i][5] * basket[i][6]+'</div>'+
                '</div>');
            }
        }
      
      </script>


      <!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script> -->
      <script type="text/javascript">
          //plugin bootstrap minus and plus
          //http://jsfiddle.net/laelitenetwork/puJ6G/
          
          var basket_item = JSON.parse(sessionStorage.getItem("basket"));
          $('.btn-number').click(function(e){
            e.preventDefault();
            
            fieldName = $(this).attr('data-field');
            type      = $(this).attr('data-type');
            var input = $("input[name='"+fieldName+"']");
            var price = document.getElementById(fieldName);
            var currentVal = parseInt(input.val());
            if (!isNaN(currentVal)) {
                if(type == 'minus') {
                    
                    if(currentVal > input.attr('min')) {
                        input.val(currentVal - 1).change();
                    } 
                    if(parseInt(input.val()) == input.attr('min')) {
                        $(this).attr('disabled', true);
                    }
                    price.innerText = parseInt(input.val())*basket_item[fieldName[6]][6];
                } else if(type == 'plus') {
  
                    if(currentVal < input.attr('max')) {
                        input.val(currentVal + 1).change();
                    }
                    if(parseInt(input.val()) == input.attr('max')) {
                        $(this).attr('disabled', true);
                    }
                    price.innerText = parseInt(input.val())*basket_item[fieldName[6]][6];
                }
            } else {
                input.val(0);
            }
          });
          $('.input-number').focusin(function(){
            $(this).data('oldValue', $(this).val());
          });
          $('.input-number').change(function() {
            
            minValue =  parseInt($(this).attr('min'));
            maxValue =  parseInt($(this).attr('max'));
            valueCurrent = parseInt($(this).val());
            
            name = $(this).attr('name');
            if(valueCurrent >= minValue) {
                $(".btn-number[data-type='minus'][data-field='"+name+"']").removeAttr('disabled')
            } else {
                alert('Sorry, the minimum value was reached');
                $(this).val($(this).data('oldValue'));
            }
            if(valueCurrent <= maxValue) {
                $(".btn-number[data-type='plus'][data-field='"+name+"']").removeAttr('disabled')
            } else {
                alert('Sorry, the maximum value was reached');
                $(this).val($(this).data('oldValue'));
            }
            
            
          });
          $(".input-number").keydown(function (e) {
              // Allow: backspace, delete, tab, escape, enter and .
              if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 190]) !== -1 ||
                  // Allow: Ctrl+A
                  (e.keyCode == 65 && e.ctrlKey === true) || 
                  // Allow: home, end, left, right
                  (e.keyCode >= 35 && e.keyCode <= 39)) {
                      // let it happen, don't do anything
                        return;
              }
              // Ensure that it is a number and stop the keypress
              if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                  e.preventDefault();
              }
          });
      </script>

    <div class="order_btn_container">
      <div class="order_bottom">
          <button type="button" class="btn btn-danger cancel_btn" style="padding:0; font-size: 15px;" onclick="backToPage()">이전으로</button>
          <button type="button" class="btn btn-success order_btn" style="padding:0; font-size: 15px;" onclick="orderComplete()">완료</button>
      </div>
    </div>

    <script>
      window.onload=function(){
window.resizeTo(390,844); // 웹페이지의 크기를 가로 1280 , 세로 800 으로 고정(확장 및 축소)
}
        function backToPage(){
          location.href='burger_set.html';
        }
        function orderComplete() {
            // 개수 업데이트 필요
            var basket_update = [];
            var basket_items = JSON.parse(sessionStorage.getItem("basket"));
            // sessionStorage.removeItem("basket");
            for (i = 0; i < basket_items.length; i++) {
              // console.log(document.getElementById('input-'+i));
              basket_items[i][5] = document.getElementById('input-'+i).value;
              basket_update.push([basket_items[i][0], basket_items[i][1], basket_items[i][2], basket_items[i][3], basket_items[i][4],parseInt(basket_items[i][5]), basket_items[i][6]]);
            }
            sessionStorage.setItem('basket', JSON.stringify(basket_update));
            location.href='burger_set.html';
        }
        getMission();
        timer();

        if(JSON.parse(sessionStorage.getItem("basket")).length >=12){
          document.getElementsByClassName("order_btn_container")[0].style.position = "relative";
        }else{
          document.getElementsByClassName("order_btn_container")[0].style.position = "absolute";

        }
        
        
        // recommend_func();
        // side_func();
    </script>

</body>
</html>